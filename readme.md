# db-presets

Тулза для работы с пресетами (то бишь дампами) PostgreSQL.
Хранит пресеты на Amazon S3.
Поддерживает лок объектов на запись.
Хранит историю изменений объекта.

## Требования

* Linux
* xz
* PostgreSQL
* Node.js >= 10.15.3
* /opt с установленным приложением.
* Для работы обязательно проставить переменные окружения.

## Установка

`npm i -g db-presets`

В системе появляется тулза `db-p`.

`db-p -h`

## [Переменные окружения](docs/env-vars.md)

## [Сценарии использования](docs/use-cases.md)

## Рекомендации

* Делать пресеты нужно на релизных ветках, чтобы на них всегда можно было накатить миграции от тестовой ветки,
или от новых веток.

## Начало работы. Создание корзины на S3, создание и сохранение пресетов.

* На Amazon S3 создаем хранилище типа
https://aws.amazon.com/s3/storage-classes/?nc=sn&loc=3#Infrequent_access.

* Создаем ключи шифрования.

* Запускаем приложение с нужным пресетом (м.б. с пустым), работаем с приложением, заполняя нужный пресет.

* Придумываем имя пресету, и сохраняем его в Amazon S3.

* И так мы создаем несколько пресетов.

## Воркфлоу для ручного тестирования.

* Стягиваете на тестовую машину семейство нужных пресетов (делается одной командой).

* Устанавливаете один нужный пресет.

* Тестируете.

* Устанавливаете другой пресет.

* Тестируете. И т.д.

## Воркфлоу для автотестов.

* В CI систему, перед запуском автотестов вставляем скрипт, стягивающий семейство нужных пресетов 

* Используя CMD Line или API - подменяете пресеты и рестартуете приложение прямо из тестов.
